set(SOURCE_FILES App.cc App.h renderer/vulkan/api/VulkanInstance.cc renderer/vulkan/api/VulkanInstance.h renderer/vulkan/api/error.h renderer/vulkan/api/structures/define_structure.h renderer/vulkan/api/structures/ApplicationInfo.h renderer/vulkan/api/structures/InstanceCreateInfo.h util/build_definition.h renderer/vulkan/api/util.h renderer/vulkan/api/DebugUtilsMessenger.cc renderer/vulkan/api/DebugUtilsMessenger.h renderer/vulkan/api/structures/DebugUtilsMessengerCreateInfo.h renderer/vulkan/api/PhysicalDevice.cc renderer/vulkan/api/PhysicalDevice.h renderer/vulkan/api/structures/Win32SurfaceCreateInfo.h renderer/vulkan/api/Surface.cc renderer/vulkan/api/Surface.h renderer/vulkan/api/structures/DeviceQueueCreateInfo.h renderer/vulkan/api/VirtualDevice.cc renderer/vulkan/api/VirtualDevice.h renderer/vulkan/api/structures/DeviceCreateInfo.h renderer/vulkan/api/structures/PhysicalDeviceFeatures.h renderer/vulkan/api/structures/BufferCreateInfo.h renderer/vulkan/api/structures/default.h renderer/vulkan/api/Buffer.cc renderer/vulkan/api/Buffer.h renderer/vulkan/api/DeviceMemory.cc renderer/vulkan/api/DeviceMemory.h renderer/vulkan/api/structures/MemoryAllocateInfo.h renderer/vulkan/api/Queue.cc renderer/vulkan/api/Queue.h renderer/vulkan/api/structures/CommandPoolCreateInfo.h renderer/vulkan/api/CommandPool.cc renderer/vulkan/api/CommandPool.h renderer/vulkan/api/structures/CommandBufferAllocateInfo.h renderer/vulkan/api/structures/CommandBufferBeginInfo.h renderer/vulkan/api/structures/SubmitInfo.h renderer/vulkan/api/CommandBuffer.cc renderer/vulkan/api/CommandBuffer.h renderer/vulkan/api/structures/FenceCreateInfo.h renderer/vulkan/api/Fence.cc renderer/vulkan/api/Fence.h renderer/vulkan/api/structures/DescriptorSetLayoutBinding.h renderer/vulkan/api/structures/DescriptorSetLayoutCreateInfo.h renderer/vulkan/api/structures/PipelineLayoutCreateInfo.h renderer/vulkan/api/structures/SwapchainCreateInfo.h renderer/vulkan/api/structures/ImageViewCreateInfo.h renderer/vulkan/api/structures/ImageCreateInfo.h renderer/vulkan/api/structures/Extent3D.h renderer/vulkan/api/structures/ImageSubresourceRange.h renderer/vulkan/api/structures/ShaderModuleCreateInfo.h renderer/vulkan/api/structures/PipelineShaderStageCreateInfo.h renderer/vulkan/api/structures/VertexInputBindingDescription.h renderer/vulkan/api/structures/VertexInputAttributeDescription.h renderer/vulkan/api/structures/PipelineVertexInputStateCreateInfo.h renderer/vulkan/api/structures/PipelineInputAssemblyStateCreateInfo.h renderer/vulkan/api/structures/Viewport.h renderer/vulkan/api/structures/Extent2D.h renderer/vulkan/api/structures/Offset2D.h renderer/vulkan/api/structures/Rect2D.h renderer/vulkan/api/structures/PipelineViewportStateCreateInfo.h renderer/vulkan/api/structures/PipelineRasterizationStateCreateInfo.h renderer/vulkan/api/structures/PipelineMultisampleStateCreateInfo.h renderer/vulkan/api/structures/PipelineColorBlendAttachmentState.h renderer/vulkan/api/structures/PipelineColorBlendStateCreateInfo.h renderer/vulkan/api/structures/AttachmentDescription.h renderer/vulkan/api/structures/AttachmentReference.h renderer/vulkan/api/structures/SubpassDescription.h renderer/vulkan/api/structures/SubpassDependency.h renderer/vulkan/api/structures/RenderPassCreateInfo.h renderer/vulkan/api/structures/PipelineDepthStencilStateCreateInfo.h renderer/vulkan/api/structures/GraphicsPipelineCreateInfo.h renderer/vulkan/api/structures/FramebufferCreateInfo.h renderer/vulkan/api/structures/DescriptorPoolSize.h renderer/vulkan/api/structures/DescriptorPoolCreateInfo.h renderer/vulkan/api/structures/DescriptorSetAllocateInfo.h renderer/vulkan/api/structures/DescriptorBufferInfo.h renderer/vulkan/api/structures/WriteDescriptorSet.h renderer/vulkan/api/structures/RenderPassBeginInfo.h renderer/vulkan/api/structures/SemaphoreCreateInfo.h renderer/vulkan/api/structures/PresentInfoKHR.h renderer/vulkan/api/Swapchain.cc renderer/vulkan/api/Swapchain.h renderer/vulkan/api/structures/PipelineTessellationStateCreateInfo.h renderer/vulkan/api/GraphicsPipeline.cc renderer/vulkan/api/GraphicsPipeline.h renderer/vulkan/api/structures/PipelineDynamicStateCreateInfo.h renderer/vulkan/api/ShaderModule.cc renderer/vulkan/api/ShaderModule.h renderer/vulkan/api/PipelineLayout.cc renderer/vulkan/api/PipelineLayout.h renderer/vulkan/api/RenderPass.cc renderer/vulkan/api/RenderPass.h renderer/vulkan/api/DescriptorSetLayout.cc renderer/vulkan/api/DescriptorSetLayout.h renderer/vulkan/api/Image.cc renderer/vulkan/api/Image.h renderer/vulkan/api/Semaphore.cc renderer/vulkan/api/Semaphore.h renderer/vulkan/api/ImageView.cc renderer/vulkan/api/ImageView.h renderer/vulkan/api/Framebuffer.cc renderer/vulkan/api/Framebuffer.h renderer/vulkan/api/structures/ClearValue.h renderer/vulkan/api/structures/ClearDepthStencilValue.h renderer/vulkan/api/structures/ClearColorValue.h renderer/vulkan/api/DescriptorSet.cc renderer/vulkan/api/DescriptorSet.h renderer/vulkan/api/DescriptorPool.cc renderer/vulkan/api/DescriptorPool.h renderer/vulkan/api/SynchronisationPack.cc renderer/vulkan/api/SynchronisationPack.h system/windowing/input/Keyboard.cc system/windowing/input/Keyboard.h core/threading/MultithreadedMessageQueue.h renderer/vulkan/api/structures/BufferImageCopy.h renderer/vulkan/api/structures/ImageSubresourceLayers.h renderer/vulkan/api/structures/ImageMemoryBarrier.h renderer/vulkan/api/structures/SamplerCreateInfo.h renderer/vulkan/api/Sampler.cc renderer/vulkan/api/Sampler.h renderer/vulkan/api/structures/DescriptorImageInfo.h renderer/vertices/PositionNormalTextureVertex.h renderer/vulkan/api/structures/PushConstantRange.h util/include/sdl.h util/include/glm.h renderer/vulkan/api/SubpassReference.h renderer/vulkan/api/memory/DeviceMemoryAllocator.cc renderer/vulkan/api/memory/DeviceMemoryAllocator.h memory/MemoryAllocation.h memory/DeviceHeap.cc memory/DeviceHeap.h memory/MemoryBlock.h memory/Allocator.h memory/ReservedBlock.cc memory/ReservedBlock.h memory/AllocatedBlock.h core/files/bmp.h core/files/bmp.cc util/include/windows.h renderer/vulkan/api/structures/PipelineCacheCreateInfo.h renderer/vulkan/api/PipelineCache.cc renderer/vulkan/api/PipelineCache.h util/filenames.h core/files/file.h core/files/file.cc core/math/Rect.h renderer/vulkan/api/structures/MemoryBarrier.h renderer/vulkan/api/structures/BufferMemoryBarrier.h core/files/obj.cc core/files/obj.h renderer/vulkan/api/structures/MappedMemoryRange.h memory/Alignment.h memory/Alignment.cc renderer/vulkan/api/memory/BoundDeviceMemory.cc renderer/vulkan/api/memory/BoundDeviceMemory.h system/windowing/input/Mouse.cc system/windowing/input/Mouse.h core/files/png/png.h core/files/png/png.cc core/files/png/HuffmanCode.h core/files/png/HuffmanCode.cc core/diagnostics/log.h core/diagnostics/log.cc system/windowing/Window.cc system/windowing/Window.h engine/behaviour/UpdateContext.h renderer/vulkan/BoundBuffer.h renderer/vulkan/BoundImage.h util/include/glm.cc renderer/vertices/PositionTextureVertex.h game/Scene.cc game/Scene.h renderer/vulkan/buffer_structures/GlobalRenderUniform.h game/Camera.cc game/Camera.h core/files/vertex_loader.h renderer/vertices/PositionNormalTextureVertex.cc renderer/vertices/PositionTextureVertex.cc core/files/DrawVertices.h renderer/vertices/PositionVertex.cc renderer/vertices/PositionVertex.h core/algorithms/RandomNumberGenerator.cc core/algorithms/RandomNumberGenerator.h renderer/vulkan/api/SurfaceFactory.h renderer/vulkan/api/structures/XlibSurfaceCreateInfo.h renderer/vulkan/SwapchainWithResources.cc renderer/vulkan/SwapchainWithResources.h renderer/vulkan/Vulkan.cc renderer/vulkan/Vulkan.h game/Controls.h game/Controls.cc system/System.cc system/System.h run.cc run.h renderer/vulkan/VulkanSystem.h engine/composition/SceneComposer.h engine/composition/CompositionBuilder.h engine/composition/CompositionBuilder.cc engine/composition/Renderer.h engine/composition/RenderType.h engine/composition/SceneComposer.cc game/behaviours/SunMovement.cc game/behaviours/SunMovement.h engine/behaviour/Behaviour.h engine/actor/Actor.cc engine/actor/Actor.h engine/property/traits/Transformable.h engine/composition/MeshHandle.h engine/composition/MeshLoadParams.h renderer/vertices/StructuredVertexData.h game/behaviours/ConstantMovement.cc game/behaviours/ConstantMovement.h game/behaviours/PlayerMovement.cc game/behaviours/PlayerMovement.h renderer/vulkan/Texture.h game/behaviours/ExhaustParticleController.cc game/behaviours/ExhaustParticleController.h engine/composition/ParticleBehaviour.h engine/composition/ActorConsumer.h renderer/vulkan/api/ComputePipeline.cc renderer/vulkan/api/ComputePipeline.h renderer/vulkan/api/structures/ComputePipelineCreateInfo.h renderer/vulkan/api/structures/SpecializationInfo.h renderer/vulkan/api/structures/SpecializationMapEntry.h engine/property/type/Transform.cc engine/property/type/Transform.h engine/property/PropertyKey.h engine/property/Property.h game/behaviours/CameraController.cc game/behaviours/CameraController.h engine/property/traits/Visible.h game/behaviours/BackgroundMusic.cc game/behaviours/BackgroundMusic.h engine/property/type/SoundEmitter.cc engine/property/type/SoundEmitter.h system/sound/Sound.cc system/sound/Sound.h game/behaviours/LaserEmitter.cc game/behaviours/LaserEmitter.h game/behaviours/DespawnAfterPeriod.cc game/behaviours/DespawnAfterPeriod.h engine/actor/ActorOwner.h engine/actor/ActorKey.h engine/composition/ActorToSpawn.h engine/composition/SceneGraph.cc engine/composition/SceneGraph.h engine/resource/Resource.h engine/composition/SpawnDependencies.h engine/composition/behaviour_utils.h engine/composition/parameter_utils.h system/sound/vorbis.h engine/composition/PointLight.h engine/composition/LightSource.h engine/composition/LightSourceComposition.h engine/composition/PointLight.cc renderer/vulkan/BoundImage.cc renderer/vulkan/BoundBuffer.cc core/adapters/MapValueIterator.h renderer/vulkan/IndexedVertexBuffer.cc renderer/vulkan/IndexedVertexBuffer.h renderer/vulkan/buffer_structures/Particle.h renderer/vulkan/buffer_structures/ParticleRender.h renderer/vulkan/buffer_structures/ParticleSpawnParams.h renderer/vulkan/buffer_structures/GlobalComputeUniform.h renderer/vulkan/buffer_structures/ModelTransform.h renderer/vulkan/Pipeline.h renderer/vulkan/render_graph/RenderGraph.cc renderer/vulkan/render_graph/RenderGraph.h renderer/vulkan/render_graph/layout/RenderGraphLayout.h renderer/vulkan/render_graph/layout/builder/RenderGraphLayoutBuilder.cc renderer/vulkan/render_graph/layout/builder/RenderGraphLayoutBuilder.h renderer/vulkan/render_graph/layout/builder/DescriptorSetBuilder.cc renderer/vulkan/render_graph/layout/builder/DescriptorSetBuilder.h renderer/vulkan/render_graph/layout/builder/bindings.h renderer/vulkan/render_graph/layout/builder/ShaderBuilder.cc renderer/vulkan/render_graph/layout/builder/ShaderBuilder.h renderer/vulkan/render_graph/layout/builder/DescriptorReferenceBuilder.cc renderer/vulkan/render_graph/layout/builder/DescriptorReferenceBuilder.h renderer/vulkan/render_graph/layout/builder/VertexAttributesBuilder.cc renderer/vulkan/render_graph/layout/builder/VertexAttributesBuilder.h renderer/vulkan/render_graph/layout/Binding.h renderer/vulkan/render_graph/layout/PipelineKey.h renderer/vulkan/render_graph/HostDescriptorWriter.h renderer/vulkan/TransformDescriptorWriter.cc renderer/vulkan/TransformDescriptorWriter.h renderer/vulkan/ParticleComputeHandler.cc renderer/vulkan/ParticleComputeHandler.h engine/resource/ReleaseListResource.h renderer/vulkan/render_graph/layout/DescriptorSetStructure.h renderer/vulkan/render_graph/layout/ComputePipelineStructure.h renderer/vulkan/render_graph/layout/ShaderStructure.h renderer/vulkan/render_graph/layout/GraphicsPipelineStructure.h renderer/vulkan/render_graph/InsertPipelineBuilder.cc renderer/vulkan/render_graph/InsertPipelineBuilder.h renderer/vulkan/render_graph/InsertComputeInfo.h renderer/vulkan/render_graph/InsertRenderInfo.h renderer/vulkan/api/structures/CommandBufferInheritanceInfo.h engine/resource/ResourceKey.h engine/resource/ResourceList.h core/algorithms/KeyGenerator.cc core/algorithms/KeyGenerator.h game/ui_pages.h engine/property/type/Visibility.cc engine/property/type/Visibility.h game/behaviours/PauseMenuToggle.cc game/behaviours/PauseMenuToggle.h engine/ui/parse_xml_tree.cc engine/ui/parse_xml_tree.h engine/ui/DrawList.h engine/ui/UiDrawList.cc engine/ui/UiDrawList.h engine/ui/TextCase.h engine/ui/Canvas.cc engine/ui/Canvas.h core/text/FontAtlas.cc core/text/FontAtlas.h util/include/freetype.h renderer/vertices/PositionColorVertex.cc renderer/vertices/PositionColorVertex.h renderer/vulkan/VertexBuffer.h renderer/vulkan/RawVertexBuffer.cc renderer/vulkan/RawVertexBuffer.h util/include/glm_hash.h engine/ui/TextAlignment.h engine/ui/Color.h engine/ui/UiRenderer.cc engine/ui/UiRenderer.h engine/ui/Orientation.h engine/ui/elements/listbox/ListBox.h engine/ui/elements/gridlist/GridList.h engine/ui/produce_ui_tree.cc engine/ui/produce_ui_tree.h engine/ui/ParseTree.h engine/ui/UiTree.h engine/ui/elements/listbox/ListBoxUiElement.h engine/ui/UiElement.h engine/ui/elements/listbox/ListBoxUiElement.cc engine/ui/elements/gridlist/GridListUiElement.cc engine/ui/elements/gridlist/GridListUiElement.h engine/ui/Element.h renderer/vulkan/GraphicsPipelineTemplateKey.h engine/ui/elements/slider/Slider.h engine/ui/elements/slider/SliderUiElement.cc engine/ui/elements/slider/SliderUiElement.h engine/ui/elements/togglebox/ToggleBox.h engine/ui/elements/togglebox/ToggleBoxUiElement.cc engine/ui/elements/togglebox/ToggleBoxUiElement.h renderer/vertices/TextVertex.cc renderer/vertices/TextVertex.h core/text/GlyphString.h core/text/GlyphString.cc engine/ui/Event.h engine/ui/EventConsumer.h system/windowing/WindowEventConsumer.h system/windowing/WindowEventConsumerConsumer.h engine/ui/elements/gridlist/GridListLayout.h engine/ui/elements/listbox/ListBoxLayout.h engine/ui/elements/slider/SliderLayout.h engine/ui/elements/togglebox/ToggleBoxLayout.h engine/ui/LayoutCalculator.cc engine/ui/LayoutCalculator.h engine/ui/Action.h engine/ui/elements/listbox/ListBoxParse.h engine/ui/ElementContainer.h engine/ui/elements/listbox/ListBoxElement.h engine/ui/elements/gridlist/GridListParse.h engine/ui/elements/gridlist/GridListElement.h engine/ui/elements/slider/SliderParse.h engine/ui/elements/togglebox/ToggleBoxParse.h engine/ui/elements/togglebox/ToggleBoxElement.h engine/ui/FocusTracker.cc engine/ui/FocusTracker.h engine/ui/Focusable.h engine/property/type/GraphicalInterface.cc engine/property/type/GraphicalInterface.h engine/ui/DistanceUnit.h engine/ui/Margin.h core/strings/split.cc core/strings/split.h game/viewmodels/PauseMenuViewModel.cc game/viewmodels/PauseMenuViewModel.h engine/ui/Bound.h engine/ui/ViewModel.h engine/ui/Binding.h engine/ui/Bindable.h engine/ui/ReadWriteable.h engine/ui/UnboundValue.h Settings.cc Settings.h game/GraphicsSettingsConfigurator.h engine/behaviour/Updateable.h core/adapters/function_traits.h core/threading/BinarySemaphore.cc core/threading/BinarySemaphore.h core/images/Bitmap.cc core/images/Bitmap.h core/math/transform.h core/math/wrap.h core/math/clamp.h engine/property/PropertyCollection.h engine/resource/ResourceCollection.cc engine/resource/ResourceCollection.h engine/property/traits/default/AlwaysVisible.cc engine/property/traits/default/AlwaysVisible.h core/diagnostics/profile.h ../profiling/main.cc core/strings/format.cc core/strings/format.h core/files/png/defilter.cc core/files/png/defilter.h core/files/png/decompress_zlib.cc core/files/png/decompress_zlib.h core/files/png/stream.cc core/files/png/stream.h core/math/Range.h core/math/bytes.h core/files/png/decompress_deflate.cc core/files/png/decompress_deflate.h core/math/bits.cc core/math/bits.h core/math/integer_math.h core/literals.h core/diagnostics/ErrorReporter.cc core/diagnostics/ErrorReporter.h core/diagnostics/SoundErrorReporter.h core/diagnostics/ErrorReport.h asset.h)

add_library(${CORE_LIBRARY_NAME} ${SOURCE_FILES})

target_include_directories(
    ${CORE_LIBRARY_NAME}
    PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${VULKAN_SDK}/include
    ${DEPENDENCIES_DIR}/sdl/include
    ${DEPENDENCIES_DIR}/freetype/include
    ${DEPENDENCIES_DIR}/glm
    ${GENERATED_FILES_DIR})

find_package(Vulkan REQUIRED)

if (WIN32)
  add_executable(${CORE_BINARY_NAME} WIN32 windows_main.cc)

  target_link_libraries(
      ${CORE_BINARY_NAME}
      PRIVATE
      Vulkan::Vulkan
      SDL2::SDL2-static)
elseif (APPLE)
  add_executable(${CORE_BINARY_NAME} macos_main.cc)

  target_link_libraries(
      ${CORE_BINARY_NAME}
      PRIVATE
      Vulkan::Vulkan
      SDL2::SDL2)
elseif (UNIX)
  add_executable(${CORE_BINARY_NAME} linux_main.cc)

  find_package(Threads REQUIRED)

  target_link_libraries(
      ${CORE_LIBRARY_NAME}
      PRIVATE
      Threads::Threads
      Vulkan::Vulkan
      SDL2::SDL2)
endif ()

target_link_libraries(${CORE_BINARY_NAME} PRIVATE ${CORE_LIBRARY_NAME} freetype)

add_files_to_output(${RESOURCES_DIR} ${CMAKE_CURRENT_BINARY_DIR}/resources)

add_ui_page(${CORE_LIBRARY_NAME} ${RESOURCES_DIR}/ui/pause_menu.xml)

# Using ${RESOURCES_DIR} here causes Ninja error (wait for fix in new ninja version)
set(SHADERS resources/shaders/light.frag resources/shaders/light.vert resources/shaders/particles.comp resources/shaders/particles.frag resources/shaders/particles.vert resources/shaders/skybox.frag resources/shaders/skybox.vert resources/shaders/spaceship.frag resources/shaders/spaceship.vert resources/shaders/text.frag resources/shaders/text.vert resources/shaders/ui.frag resources/shaders/ui.vert)
add_shaders(${CORE_BINARY_NAME} "${SHADERS}")
