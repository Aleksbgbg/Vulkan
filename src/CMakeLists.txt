set(LIBRARY_NAME ${CMAKE_PROJECT_NAME}_lib)
set(BINARY_NAME ${CMAKE_PROJECT_NAME})

set(SOURCE_FILES App.cc App.h renderer/vulkan/api/VulkanInstance.cc renderer/vulkan/api/VulkanInstance.h renderer/vulkan/api/error.h renderer/vulkan/api/structures/define_structure.h renderer/vulkan/api/structures/ApplicationInfo.h renderer/vulkan/api/structures/InstanceCreateInfo.h util/build_definition.h renderer/vulkan/api/util.h renderer/vulkan/api/DebugUtilsMessenger.cc renderer/vulkan/api/DebugUtilsMessenger.h renderer/vulkan/api/structures/DebugUtilsMessengerCreateInfo.h renderer/vulkan/api/PhysicalDevice.cc renderer/vulkan/api/PhysicalDevice.h renderer/vulkan/api/structures/Win32SurfaceCreateInfo.h renderer/vulkan/api/Surface.cc renderer/vulkan/api/Surface.h renderer/vulkan/api/structures/DeviceQueueCreateInfo.h renderer/vulkan/api/VirtualDevice.cc renderer/vulkan/api/VirtualDevice.h renderer/vulkan/api/structures/DeviceCreateInfo.h renderer/vulkan/api/structures/PhysicalDeviceFeatures.h renderer/vulkan/api/structures/BufferCreateInfo.h renderer/vulkan/api/structures/default.h renderer/vulkan/api/Buffer.cc renderer/vulkan/api/Buffer.h renderer/vulkan/api/DeviceMemory.cc renderer/vulkan/api/DeviceMemory.h renderer/vulkan/api/structures/MemoryAllocateInfo.h renderer/vulkan/api/Queue.cc renderer/vulkan/api/Queue.h renderer/vulkan/api/structures/CommandPoolCreateInfo.h renderer/vulkan/api/CommandPool.cc renderer/vulkan/api/CommandPool.h renderer/vulkan/api/structures/CommandBufferAllocateInfo.h renderer/vulkan/api/structures/CommandBufferBeginInfo.h renderer/vulkan/api/structures/SubmitInfo.h renderer/vulkan/api/CommandBuffer.cc renderer/vulkan/api/CommandBuffer.h renderer/vulkan/api/structures/FenceCreateInfo.h renderer/vulkan/api/Fence.cc renderer/vulkan/api/Fence.h renderer/vulkan/api/structures/DescriptorSetLayoutBinding.h renderer/vulkan/api/structures/DescriptorSetLayoutCreateInfo.h renderer/vulkan/api/structures/PipelineLayoutCreateInfo.h renderer/vulkan/api/structures/SwapchainCreateInfo.h renderer/vulkan/api/structures/ImageViewCreateInfo.h renderer/vulkan/api/structures/ImageCreateInfo.h renderer/vulkan/api/structures/Extent3D.h renderer/vulkan/api/structures/ImageSubresourceRange.h renderer/vulkan/api/structures/ShaderModuleCreateInfo.h renderer/vulkan/api/structures/PipelineShaderStageCreateInfo.h renderer/vulkan/api/structures/VertexInputBindingDescription.h renderer/vulkan/api/structures/VertexInputAttributeDescription.h renderer/vulkan/api/structures/PipelineVertexInputStateCreateInfo.h renderer/vulkan/api/structures/PipelineInputAssemblyStateCreateInfo.h renderer/vulkan/api/structures/Viewport.h renderer/vulkan/api/structures/Extent2D.h renderer/vulkan/api/structures/Offset2D.h renderer/vulkan/api/structures/Rect2D.h renderer/vulkan/api/structures/PipelineViewportStateCreateInfo.h renderer/vulkan/api/structures/PipelineRasterizationStateCreateInfo.h renderer/vulkan/api/structures/PipelineMultisampleStateCreateInfo.h renderer/vulkan/api/structures/PipelineColorBlendAttachmentState.h renderer/vulkan/api/structures/PipelineColorBlendStateCreateInfo.h renderer/vulkan/api/structures/AttachmentDescription.h renderer/vulkan/api/structures/AttachmentReference.h renderer/vulkan/api/structures/SubpassDescription.h renderer/vulkan/api/structures/SubpassDependency.h renderer/vulkan/api/structures/RenderPassCreateInfo.h renderer/vulkan/api/structures/PipelineDepthStencilStateCreateInfo.h renderer/vulkan/api/structures/GraphicsPipelineCreateInfo.h renderer/vulkan/api/structures/FramebufferCreateInfo.h renderer/vulkan/api/structures/DescriptorPoolSize.h renderer/vulkan/api/structures/DescriptorPoolCreateInfo.h renderer/vulkan/api/structures/DescriptorSetAllocateInfo.h renderer/vulkan/api/structures/DescriptorBufferInfo.h renderer/vulkan/api/structures/WriteDescriptorSet.h renderer/vulkan/api/structures/RenderPassBeginInfo.h renderer/vulkan/api/structures/SemaphoreCreateInfo.h renderer/vulkan/api/structures/PresentInfoKHR.h renderer/vulkan/api/Swapchain.cc renderer/vulkan/api/Swapchain.h renderer/vulkan/api/structures/PipelineTessellationStateCreateInfo.h renderer/vulkan/api/Pipeline.cc renderer/vulkan/api/Pipeline.h renderer/vulkan/api/structures/PipelineDynamicStateCreateInfo.h renderer/vulkan/api/ShaderModule.cc renderer/vulkan/api/ShaderModule.h renderer/vulkan/api/PipelineLayout.cc renderer/vulkan/api/PipelineLayout.h renderer/vulkan/api/RenderPass.cc renderer/vulkan/api/RenderPass.h renderer/vulkan/api/DescriptorSetLayout.cc renderer/vulkan/api/DescriptorSetLayout.h renderer/vulkan/api/Image.cc renderer/vulkan/api/Image.h renderer/vulkan/api/Semaphore.cc renderer/vulkan/api/Semaphore.h renderer/vulkan/api/ImageView.cc renderer/vulkan/api/ImageView.h renderer/vulkan/api/Framebuffer.cc renderer/vulkan/api/Framebuffer.h renderer/vulkan/api/structures/ClearValue.h renderer/vulkan/api/structures/ClearDepthStencilValue.h renderer/vulkan/api/structures/ClearColorValue.h renderer/vulkan/api/DescriptorSet.cc renderer/vulkan/api/DescriptorSet.h renderer/vulkan/api/DescriptorPool.cc renderer/vulkan/api/DescriptorPool.h renderer/vulkan/api/SynchronisationPack.cc renderer/vulkan/api/SynchronisationPack.h system/windowing/input/Keyboard.cc system/windowing/input/Keyboard.h general/threading/MultithreadedMessageQueue.h renderer/vulkan/api/structures/BufferImageCopy.h renderer/vulkan/api/structures/ImageSubresourceLayers.h renderer/vulkan/api/structures/ImageMemoryBarrier.h renderer/vulkan/api/structures/SamplerCreateInfo.h renderer/vulkan/api/Sampler.cc renderer/vulkan/api/Sampler.h renderer/vulkan/api/structures/DescriptorImageInfo.h renderer/vertices/PositionNormalTextureVertex.h renderer/vulkan/api/structures/PushConstantRange.h util/include/sdl.h util/include/glm.h renderer/vulkan/api/SubpassReference.h renderer/vulkan/api/memory/DeviceMemoryAllocator.cc renderer/vulkan/api/memory/DeviceMemoryAllocator.h memory/MemoryAllocation.h memory/DeviceHeap.cc memory/DeviceHeap.h memory/MemoryBlock.h memory/Allocator.h memory/ReservedBlock.cc memory/ReservedBlock.h memory/AllocatedBlock.h general/files/images/bmp.h general/files/images/bmp.cc util/include/windows.h renderer/vulkan/api/structures/PipelineCacheCreateInfo.h renderer/vulkan/api/PipelineCache.cc renderer/vulkan/api/PipelineCache.h util/filenames.h general/files/file.h general/files/file.cc general/geometry/Rect.h renderer/vulkan/api/structures/MemoryBarrier.h renderer/vulkan/api/structures/BufferMemoryBarrier.h general/files/obj.cc general/files/obj.h renderer/vulkan/api/structures/MappedMemoryRange.h renderer/vulkan/DynamicUniformBuffer.h memory/Alignment.h memory/Alignment.cc renderer/vulkan/api/memory/DeviceMemorySubAllocation.cc renderer/vulkan/api/memory/DeviceMemorySubAllocation.h system/windowing/input/Mouse.cc system/windowing/input/Mouse.h general/files/images/png.h general/files/images/Image.h general/files/images/png.cc general/algorithms/HuffmanTree.h general/algorithms/HuffmanTree.cc general/logging/log.h general/logging/log.cc system/windowing/Window.cc system/windowing/Window.h game/UpdateContext.h renderer/vulkan/BufferWithMemory.h renderer/vulkan/ImageWithMemory.h util/include/glm.cc renderer/vertices/PositionTextureVertex.h game/Scene.cc game/Scene.h renderer/vulkan/ViewTransform.h game/Camera.cc game/Camera.h general/files/vertex_loader.h renderer/vertices/PositionNormalTextureVertex.cc renderer/vertices/PositionTextureVertex.cc general/files/DrawVertices.h renderer/vertices/PositionVertex.cc renderer/vertices/PositionVertex.h general/algorithms/RandomNumberGenerator.cc general/algorithms/RandomNumberGenerator.h general/geometry/Rect.cc renderer/vulkan/api/SurfaceFactory.h renderer/vulkan/api/structures/XlibSurfaceCreateInfo.h renderer/vulkan/SwapchainWithResources.cc renderer/vulkan/SwapchainWithResources.h renderer/vulkan/Vulkan.cc renderer/vulkan/Vulkan.h general/math/math.h game/Controls.h game/Controls.cc system/System.cc system/System.h run.cc run.h renderer/vulkan/VulkanSystem.h game/composition/SceneComposer.h game/composition/CompositionBuilder.h game/composition/CompositionBuilder.cc game/Renderer.h game/composition/RenderType.h game/composition/SceneComposer.cc game/behaviours/SunMovement.cc game/behaviours/SunMovement.h game/actor/behaviour/Behaviour.h game/actor/Actor.cc game/actor/Actor.h game/Transformable.h game/composition/MeshHandle.h game/composition/MeshLoadParams.h renderer/vertices/StructuredVertexData.h game/behaviours/ConstantMovement.cc game/behaviours/ConstantMovement.h game/behaviours/PlayerMovement.cc game/behaviours/PlayerMovement.h renderer/vulkan/Texture.h game/behaviours/ExhaustParticleController.cc game/behaviours/ExhaustParticleController.h game/composition/ParticleBehaviour.h game/composition/ActorConsumer.h general/operations/Consumer.h renderer/vulkan/api/ComputePipeline.cc renderer/vulkan/api/ComputePipeline.h renderer/vulkan/api/structures/ComputePipelineCreateInfo.h renderer/vulkan/api/structures/SpecializationInfo.h renderer/vulkan/api/structures/SpecializationMapEntry.h game/actor/property/Transform.cc game/actor/property/Transform.h game/actor/property/ParticleController.cc game/actor/property/ParticleController.h game/actor/property/PropertyKey.h game/actor/property/Property.h game/behaviours/CameraController.cc game/behaviours/CameraController.h game/SpawnControllable.h game/behaviours/BackgroundMusic.cc game/behaviours/BackgroundMusic.h game/actor/property/SoundEmitter.cc game/actor/property/SoundEmitter.h system/sound/Sound.cc system/sound/Sound.h game/behaviours/LaserEmitter.cc game/behaviours/LaserEmitter.h game/behaviours/DespawnAfterPeriod.cc game/behaviours/DespawnAfterPeriod.h game/actor/ActorOwner.h game/actor/ActorKey.h game/composition/ActorToSpawn.h game/composition/SceneGraph.cc game/composition/SceneGraph.h game/actor/Resource.h game/actor/actor_key_generator.cc game/actor/actor_key_generator.h game/composition/SpawnDependencies.h game/composition/behaviour_utils.h game/composition/parameter_utils.h system/sound/vorbis.h)
add_library(${LIBRARY_NAME} ${SOURCE_FILES})

target_include_directories(${LIBRARY_NAME} PUBLIC ${CMAKE_SOURCE_DIR}/lib/vulkan/include)
target_include_directories(${LIBRARY_NAME} PUBLIC ${CMAKE_SOURCE_DIR}/lib/sdl/include)
target_include_directories(${LIBRARY_NAME} PUBLIC ${CMAKE_SOURCE_DIR}/lib/glm/include)

target_include_directories(${LIBRARY_NAME} PUBLIC .)

if (WIN32)
  add_executable(${BINARY_NAME} WIN32 windows_main.cc)

  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/sdl/lib/windows/SDL2.lib)
  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/vulkan/lib/windows/vulkan-1.lib)
elseif (UNIX)
  add_executable(${BINARY_NAME} linux_main.cc)

  find_package(Threads REQUIRED)
  find_package(SDL2 REQUIRED SDL2)
  target_link_libraries(${LIBRARY_NAME} PRIVATE Threads::Threads)
  target_link_libraries(${BINARY_NAME} PRIVATE SDL2)
  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/vulkan/lib/linux/libvulkan.so)
endif ()
target_link_libraries(${BINARY_NAME} PRIVATE ${LIBRARY_NAME})

add_files_to_output(${CMAKE_SOURCE_DIR}/lib/sdl/bin ${CMAKE_CURRENT_BINARY_DIR})
add_files_to_output(${CMAKE_SOURCE_DIR}/resources ${CMAKE_CURRENT_BINARY_DIR}/resources)

set(SHADERS resources/shaders/light.frag resources/shaders/light.vert resources/shaders/particles.comp resources/shaders/particles.frag resources/shaders/particles.vert resources/shaders/sky.frag resources/shaders/sky.vert resources/shaders/spaceship.frag resources/shaders/spaceship.vert)
add_shaders(${BINARY_NAME} "${SHADERS}")
