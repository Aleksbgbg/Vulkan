set(LIBRARY_NAME ${CMAKE_PROJECT_NAME}_lib)
set(BINARY_NAME ${CMAKE_PROJECT_NAME})

set(SOURCE_FILES App.cc App.h renderer/vulkan/api/VulkanInstance.cc renderer/vulkan/api/VulkanInstance.h renderer/vulkan/api/error.h renderer/vulkan/api/structures/define_structure.h renderer/vulkan/api/structures/ApplicationInfo.h renderer/vulkan/api/structures/InstanceCreateInfo.h util/build_definition.h renderer/vulkan/api/util.h renderer/vulkan/api/DebugUtilsMessenger.cc renderer/vulkan/api/DebugUtilsMessenger.h renderer/vulkan/api/structures/DebugUtilsMessengerCreateInfo.h renderer/vulkan/api/PhysicalDevice.cc renderer/vulkan/api/PhysicalDevice.h renderer/vulkan/api/structures/Win32SurfaceCreateInfo.h renderer/vulkan/api/Surface.cc renderer/vulkan/api/Surface.h renderer/vulkan/api/structures/DeviceQueueCreateInfo.h renderer/vulkan/api/VirtualDevice.cc renderer/vulkan/api/VirtualDevice.h renderer/vulkan/api/structures/DeviceCreateInfo.h renderer/vulkan/api/structures/PhysicalDeviceFeatures.h renderer/vulkan/api/structures/BufferCreateInfo.h renderer/vulkan/api/structures/default.h renderer/vulkan/api/Buffer.cc renderer/vulkan/api/Buffer.h renderer/vulkan/api/DeviceMemory.cc renderer/vulkan/api/DeviceMemory.h renderer/vulkan/api/structures/MemoryAllocateInfo.h renderer/vulkan/api/Queue.cc renderer/vulkan/api/Queue.h renderer/vulkan/api/structures/CommandPoolCreateInfo.h renderer/vulkan/api/CommandPool.cc renderer/vulkan/api/CommandPool.h renderer/vulkan/api/structures/CommandBufferAllocateInfo.h renderer/vulkan/api/structures/CommandBufferBeginInfo.h renderer/vulkan/api/structures/SubmitInfo.h renderer/vulkan/api/CommandBuffer.cc renderer/vulkan/api/CommandBuffer.h renderer/vulkan/api/structures/FenceCreateInfo.h renderer/vulkan/api/Fence.cc renderer/vulkan/api/Fence.h renderer/vulkan/api/structures/DescriptorSetLayoutBinding.h renderer/vulkan/api/structures/DescriptorSetLayoutCreateInfo.h renderer/vulkan/api/structures/PipelineLayoutCreateInfo.h renderer/vulkan/api/structures/SwapchainCreateInfo.h renderer/vulkan/api/structures/ImageViewCreateInfo.h renderer/vulkan/api/structures/ImageCreateInfo.h renderer/vulkan/api/structures/Extent3D.h renderer/vulkan/api/structures/ImageSubresourceRange.h renderer/vulkan/api/structures/ShaderModuleCreateInfo.h renderer/vulkan/api/structures/PipelineShaderStageCreateInfo.h renderer/vulkan/api/structures/VertexInputBindingDescription.h renderer/vulkan/api/structures/VertexInputAttributeDescription.h renderer/vulkan/api/structures/PipelineVertexInputStateCreateInfo.h renderer/vulkan/api/structures/PipelineInputAssemblyStateCreateInfo.h renderer/vulkan/api/structures/Viewport.h renderer/vulkan/api/structures/Extent2D.h renderer/vulkan/api/structures/Offset2D.h renderer/vulkan/api/structures/Rect2D.h renderer/vulkan/api/structures/PipelineViewportStateCreateInfo.h renderer/vulkan/api/structures/PipelineRasterizationStateCreateInfo.h renderer/vulkan/api/structures/PipelineMultisampleStateCreateInfo.h renderer/vulkan/api/structures/PipelineColorBlendAttachmentState.h renderer/vulkan/api/structures/PipelineColorBlendStateCreateInfo.h renderer/vulkan/api/structures/AttachmentDescription.h renderer/vulkan/api/structures/AttachmentReference.h renderer/vulkan/api/structures/SubpassDescription.h renderer/vulkan/api/structures/SubpassDependency.h renderer/vulkan/api/structures/RenderPassCreateInfo.h renderer/vulkan/api/structures/PipelineDepthStencilStateCreateInfo.h renderer/vulkan/api/structures/GraphicsPipelineCreateInfo.h renderer/vulkan/api/structures/FramebufferCreateInfo.h renderer/vulkan/api/structures/DescriptorPoolSize.h renderer/vulkan/api/structures/DescriptorPoolCreateInfo.h renderer/vulkan/api/structures/DescriptorSetAllocateInfo.h renderer/vulkan/api/structures/DescriptorBufferInfo.h renderer/vulkan/api/structures/WriteDescriptorSet.h renderer/vulkan/api/structures/RenderPassBeginInfo.h renderer/vulkan/api/structures/SemaphoreCreateInfo.h renderer/vulkan/api/structures/PresentInfoKHR.h renderer/vulkan/api/Swapchain.cc renderer/vulkan/api/Swapchain.h renderer/vulkan/api/structures/PipelineTessellationStateCreateInfo.h renderer/vulkan/api/GraphicsPipeline.cc renderer/vulkan/api/GraphicsPipeline.h renderer/vulkan/api/structures/PipelineDynamicStateCreateInfo.h renderer/vulkan/api/ShaderModule.cc renderer/vulkan/api/ShaderModule.h renderer/vulkan/api/PipelineLayout.cc renderer/vulkan/api/PipelineLayout.h renderer/vulkan/api/RenderPass.cc renderer/vulkan/api/RenderPass.h renderer/vulkan/api/DescriptorSetLayout.cc renderer/vulkan/api/DescriptorSetLayout.h renderer/vulkan/api/Image.cc renderer/vulkan/api/Image.h renderer/vulkan/api/Semaphore.cc renderer/vulkan/api/Semaphore.h renderer/vulkan/api/ImageView.cc renderer/vulkan/api/ImageView.h renderer/vulkan/api/Framebuffer.cc renderer/vulkan/api/Framebuffer.h renderer/vulkan/api/structures/ClearValue.h renderer/vulkan/api/structures/ClearDepthStencilValue.h renderer/vulkan/api/structures/ClearColorValue.h renderer/vulkan/api/DescriptorSet.cc renderer/vulkan/api/DescriptorSet.h renderer/vulkan/api/DescriptorPool.cc renderer/vulkan/api/DescriptorPool.h renderer/vulkan/api/SynchronisationPack.cc renderer/vulkan/api/SynchronisationPack.h system/windowing/input/Keyboard.cc system/windowing/input/Keyboard.h core/threading/MultithreadedMessageQueue.h renderer/vulkan/api/structures/BufferImageCopy.h renderer/vulkan/api/structures/ImageSubresourceLayers.h renderer/vulkan/api/structures/ImageMemoryBarrier.h renderer/vulkan/api/structures/SamplerCreateInfo.h renderer/vulkan/api/Sampler.cc renderer/vulkan/api/Sampler.h renderer/vulkan/api/structures/DescriptorImageInfo.h renderer/vertices/PositionNormalTextureVertex.h renderer/vulkan/api/structures/PushConstantRange.h util/include/sdl.h util/include/glm.h renderer/vulkan/api/SubpassReference.h renderer/vulkan/api/memory/DeviceMemoryAllocator.cc renderer/vulkan/api/memory/DeviceMemoryAllocator.h memory/MemoryAllocation.h memory/DeviceHeap.cc memory/DeviceHeap.h memory/MemoryBlock.h memory/Allocator.h memory/ReservedBlock.cc memory/ReservedBlock.h memory/AllocatedBlock.h core/files/images/bmp.h core/files/images/bmp.cc util/include/windows.h renderer/vulkan/api/structures/PipelineCacheCreateInfo.h renderer/vulkan/api/PipelineCache.cc renderer/vulkan/api/PipelineCache.h util/filenames.h core/files/file.h core/files/file.cc core/math/Rect.h renderer/vulkan/api/structures/MemoryBarrier.h renderer/vulkan/api/structures/BufferMemoryBarrier.h core/files/obj.cc core/files/obj.h renderer/vulkan/api/structures/MappedMemoryRange.h memory/Alignment.h memory/Alignment.cc renderer/vulkan/api/memory/BoundDeviceMemory.cc renderer/vulkan/api/memory/BoundDeviceMemory.h system/windowing/input/Mouse.cc system/windowing/input/Mouse.h core/files/images/png.h core/files/images/png.cc core/algorithms/HuffmanTree.h core/algorithms/HuffmanTree.cc core/logging/log.h core/logging/log.cc system/windowing/Window.cc system/windowing/Window.h game/UpdateContext.h renderer/vulkan/BoundBuffer.h renderer/vulkan/BoundImage.h util/include/glm.cc renderer/vertices/PositionTextureVertex.h game/Scene.cc game/Scene.h renderer/vulkan/buffer_structures/GlobalRenderUniform.h game/Camera.cc game/Camera.h core/files/vertex_loader.h renderer/vertices/PositionNormalTextureVertex.cc renderer/vertices/PositionTextureVertex.cc core/files/DrawVertices.h renderer/vertices/PositionVertex.cc renderer/vertices/PositionVertex.h core/algorithms/RandomNumberGenerator.cc core/algorithms/RandomNumberGenerator.h renderer/vulkan/api/SurfaceFactory.h renderer/vulkan/api/structures/XlibSurfaceCreateInfo.h renderer/vulkan/SwapchainWithResources.cc renderer/vulkan/SwapchainWithResources.h renderer/vulkan/Vulkan.cc renderer/vulkan/Vulkan.h game/Controls.h game/Controls.cc system/System.cc system/System.h run.cc run.h renderer/vulkan/VulkanSystem.h game/composition/SceneComposer.h game/composition/CompositionBuilder.h game/composition/CompositionBuilder.cc game/Renderer.h game/composition/RenderType.h game/composition/SceneComposer.cc game/behaviours/SunMovement.cc game/behaviours/SunMovement.h game/actor/behaviour/Behaviour.h game/actor/Actor.cc game/actor/Actor.h game/Transformable.h game/composition/MeshHandle.h game/composition/MeshLoadParams.h renderer/vertices/StructuredVertexData.h game/behaviours/ConstantMovement.cc game/behaviours/ConstantMovement.h game/behaviours/PlayerMovement.cc game/behaviours/PlayerMovement.h renderer/vulkan/Texture.h game/behaviours/ExhaustParticleController.cc game/behaviours/ExhaustParticleController.h game/composition/ParticleBehaviour.h game/composition/ActorConsumer.h core/operations/Consumer.h renderer/vulkan/api/ComputePipeline.cc renderer/vulkan/api/ComputePipeline.h renderer/vulkan/api/structures/ComputePipelineCreateInfo.h renderer/vulkan/api/structures/SpecializationInfo.h renderer/vulkan/api/structures/SpecializationMapEntry.h game/actor/property/Transform.cc game/actor/property/Transform.h game/actor/property/PropertyKey.h game/actor/property/Property.h game/behaviours/CameraController.cc game/behaviours/CameraController.h game/Visible.h game/behaviours/BackgroundMusic.cc game/behaviours/BackgroundMusic.h game/actor/property/SoundEmitter.cc game/actor/property/SoundEmitter.h system/sound/Sound.cc system/sound/Sound.h game/behaviours/LaserEmitter.cc game/behaviours/LaserEmitter.h game/behaviours/DespawnAfterPeriod.cc game/behaviours/DespawnAfterPeriod.h game/actor/ActorOwner.h game/actor/ActorKey.h game/composition/ActorToSpawn.h game/composition/SceneGraph.cc game/composition/SceneGraph.h game/actor/resource/Resource.h game/composition/SpawnDependencies.h game/composition/behaviour_utils.h game/composition/parameter_utils.h system/sound/vorbis.h game/composition/PointLight.h game/LightSource.h game/composition/LightSourceComposition.h game/composition/PointLight.cc renderer/vulkan/BoundImage.cc renderer/vulkan/BoundBuffer.cc core/adapters/MapValueIterator.h renderer/vulkan/IndexedVertexBuffer.cc renderer/vulkan/IndexedVertexBuffer.h renderer/vulkan/buffer_structures/Particle.h renderer/vulkan/buffer_structures/ParticleRender.h renderer/vulkan/buffer_structures/ParticleSpawnParams.h renderer/vulkan/buffer_structures/GlobalComputeUniform.h renderer/vulkan/buffer_structures/ModelTransform.h renderer/vulkan/Pipeline.h renderer/vulkan/render_graph/RenderGraph.cc renderer/vulkan/render_graph/RenderGraph.h renderer/vulkan/render_graph/layout/RenderGraphLayout.h renderer/vulkan/render_graph/layout/builder/RenderGraphLayoutBuilder.cc renderer/vulkan/render_graph/layout/builder/RenderGraphLayoutBuilder.h renderer/vulkan/render_graph/layout/builder/DescriptorSetBuilder.cc renderer/vulkan/render_graph/layout/builder/DescriptorSetBuilder.h renderer/vulkan/render_graph/layout/builder/bindings.h renderer/vulkan/render_graph/layout/builder/ShaderBuilder.cc renderer/vulkan/render_graph/layout/builder/ShaderBuilder.h renderer/vulkan/render_graph/layout/builder/DescriptorReferenceBuilder.cc renderer/vulkan/render_graph/layout/builder/DescriptorReferenceBuilder.h renderer/vulkan/render_graph/layout/builder/VertexAttributesBuilder.cc renderer/vulkan/render_graph/layout/builder/VertexAttributesBuilder.h renderer/vulkan/render_graph/layout/Binding.h renderer/vulkan/render_graph/layout/PipelineKey.h renderer/vulkan/render_graph/HostDescriptorWriter.h renderer/vulkan/TransformDescriptorWriter.cc renderer/vulkan/TransformDescriptorWriter.h renderer/vulkan/ParticleComputeHandler.cc renderer/vulkan/ParticleComputeHandler.h game/actor/CompositeResource.cc game/actor/CompositeResource.h game/actor/resource/ReleaseListResource.h renderer/vulkan/render_graph/layout/DescriptorSetStructure.h renderer/vulkan/render_graph/layout/ComputePipelineStructure.h renderer/vulkan/render_graph/layout/ShaderStructure.h renderer/vulkan/render_graph/layout/GraphicsPipelineStructure.h renderer/vulkan/render_graph/InsertPipelineBuilder.cc renderer/vulkan/render_graph/InsertPipelineBuilder.h renderer/vulkan/render_graph/InsertComputeInfo.h renderer/vulkan/render_graph/InsertRenderInfo.h renderer/vulkan/api/structures/CommandBufferInheritanceInfo.h game/actor/resource/ResourceKey.h game/actor/resource/ResourceList.h core/algorithms/KeyGenerator.cc core/algorithms/KeyGenerator.h game/ui_pages.h game/actor/property/Visibility.cc game/actor/property/Visibility.h game/behaviours/PauseMenuToggle.cc game/behaviours/PauseMenuToggle.h game/ui/parse_xml_tree.cc game/ui/parse_xml_tree.h game/DrawList.h game/ui/UiDrawList.cc game/ui/UiDrawList.h game/ui/TextCase.h game/ui/Canvas.cc game/ui/Canvas.h core/text/FontAtlas.cc core/text/FontAtlas.h util/include/freetype.h renderer/vertices/PositionColorVertex.cc renderer/vertices/PositionColorVertex.h renderer/vulkan/VertexBuffer.h renderer/vulkan/RawVertexBuffer.cc renderer/vulkan/RawVertexBuffer.h util/include/glm_hash.h game/ui/TextAlignment.h game/ui/Color.h game/ui/UiRenderer.cc game/ui/UiRenderer.h game/ui/Orientation.h game/ui/elements/listbox/ListBox.h game/ui/elements/gridlist/GridList.h game/ui/produce_ui_tree.cc game/ui/produce_ui_tree.h game/ui/ParseTree.h game/ui/UiTree.h game/ui/elements/listbox/ListBoxUiElement.h game/ui/UiElement.h game/ui/elements/listbox/ListBoxUiElement.cc game/ui/elements/gridlist/GridListUiElement.cc game/ui/elements/gridlist/GridListUiElement.h game/ui/Element.h renderer/vulkan/GraphicsPipelineTemplateKey.h game/ui/elements/slider/Slider.h game/ui/elements/slider/SliderUiElement.cc game/ui/elements/slider/SliderUiElement.h game/ui/elements/togglebox/ToggleBox.h game/ui/elements/togglebox/ToggleBoxUiElement.cc game/ui/elements/togglebox/ToggleBoxUiElement.h renderer/vertices/TextVertex.cc renderer/vertices/TextVertex.h core/text/GlyphString.h core/text/GlyphString.cc game/ui/Event.h game/ui/EventConsumer.h system/windowing/WindowEventConsumer.h system/windowing/WindowEventConsumerConsumer.h game/ui/elements/gridlist/GridListLayout.h game/ui/elements/listbox/ListBoxLayout.h game/ui/elements/slider/SliderLayout.h game/ui/elements/togglebox/ToggleBoxLayout.h game/ui/LayoutCalculator.cc game/ui/LayoutCalculator.h game/ui/Action.h game/ui/elements/listbox/ListBoxParse.h game/ui/ElementContainer.h core/adapters/Iterable.h game/ui/elements/listbox/ListBoxElement.h game/ui/elements/gridlist/GridListParse.h game/ui/elements/gridlist/GridListElement.h game/ui/elements/slider/SliderParse.h game/ui/elements/togglebox/ToggleBoxParse.h game/ui/elements/togglebox/ToggleBoxElement.h game/ui/FocusTracker.cc game/ui/FocusTracker.h game/ui/Focusable.h game/actor/property/GraphicalInterface.cc game/actor/property/GraphicalInterface.h game/ui/DistanceUnit.h game/ui/Margin.h core/strings/split.cc core/strings/split.h game/viewmodels/PauseMenuViewModel.cc game/viewmodels/PauseMenuViewModel.h game/ui/Bound.h game/ui/ViewModel.h game/ui/Binding.h game/ui/Bindable.h game/ui/ReadWriteable.h game/ui/UnboundValue.h Settings.cc Settings.h game/GraphicsSettingsConfigurator.h game/actor/Updateable.h core/adapters/function_traits.h core/threading/BinarySemaphore.cc core/threading/BinarySemaphore.h core/images/Bitmap.cc core/images/Bitmap.h core/math/transform.h core/math/wrap.h core/math/clamp.h)
add_library(${LIBRARY_NAME} ${SOURCE_FILES})

add_ui_page(${LIBRARY_NAME} ${CMAKE_SOURCE_DIR}/resources/ui/pause_menu.xml)

target_include_directories(
    ${LIBRARY_NAME}
    PUBLIC
    ${CMAKE_SOURCE_DIR}/lib/freetype/include
    ${CMAKE_SOURCE_DIR}/lib/vulkan/include
    ${CMAKE_SOURCE_DIR}/lib/sdl/include
    ${CMAKE_SOURCE_DIR}/lib/glm/include
    ${CMAKE_SOURCE_DIR}/generated)

target_include_directories(${LIBRARY_NAME} PUBLIC .)

if (WIN32)
  add_executable(${BINARY_NAME} WIN32 windows_main.cc)

  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/sdl/lib/windows/SDL2.lib)
  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/vulkan/lib/windows/vulkan-1.lib)
elseif (APPLE)
  add_executable(${BINARY_NAME} macos_main.cc)

  find_package(SDL2 REQUIRED SDL2)
  find_package(Vulkan REQUIRED)
  target_link_libraries(${LIBRARY_NAME} PRIVATE Vulkan::Vulkan)
  target_link_libraries(${BINARY_NAME} PRIVATE ${SDL2_LIBRARIES})
elseif (UNIX)
  add_executable(${BINARY_NAME} linux_main.cc)

  find_package(Threads REQUIRED)
  find_package(SDL2 REQUIRED SDL2)
  target_link_libraries(${LIBRARY_NAME} PRIVATE Threads::Threads)
  target_link_libraries(${BINARY_NAME} PRIVATE SDL2)
  target_link_libraries(${BINARY_NAME} PRIVATE ${CMAKE_SOURCE_DIR}/lib/vulkan/lib/linux/libvulkan.so)
endif ()
target_link_libraries(${BINARY_NAME} PRIVATE ${LIBRARY_NAME} freetype)

add_files_to_output(${CMAKE_SOURCE_DIR}/lib/sdl/bin ${CMAKE_CURRENT_BINARY_DIR})
add_files_to_output(${CMAKE_SOURCE_DIR}/resources ${CMAKE_CURRENT_BINARY_DIR}/resources)

set(SHADERS resources/shaders/light.frag resources/shaders/light.vert resources/shaders/particles.comp resources/shaders/particles.frag resources/shaders/particles.vert resources/shaders/skybox.frag resources/shaders/skybox.vert resources/shaders/spaceship.frag resources/shaders/spaceship.vert resources/shaders/text.frag resources/shaders/text.vert resources/shaders/ui.frag resources/shaders/ui.vert)
add_shaders(${BINARY_NAME} "${SHADERS}")
